## 커넥션 풀

**커넥션 풀이란?** 데이터베이스 연결을 미리 생성해두고 요청이 들어오면 이를 재사용하는 기법

- 데이터베이스 연결 생성 비용이 매우 크고 애플리케이션 성능을 낮출 수 있기에 사용
- 요청마다 새 연결을 생성하고 닫으면 불필요한 오버헤드 발생
- 커넥션 풀은 연결을 재사용하여 비용을 줄임

JPA 사양 자체에서는 커넥션 풀을 포함하지 않는다! 하지만 JPA 구현체나 외부 라이브러리를 사용해 커넥션 풀을 구성할 수 있다

### **Hibernate의 커넥션 풀**

1. 내장 커넥션 풀 (Hibernate Internal Pool)
   1. 하이버네이트는 기본적으로 간단한 커넥션 풀 제공
   2. 프로덕션 환경에서는 자주 사용하지 않음, 외부 커넥션 풀 라이브러리 사용이 권장
2. 외부 커넥션 풀 사용
   1. 일반적으로 HikariCP, Apache DBCP, C3P0과 같은 커넥션 풀 라이브러리 사용
   2. 강력하고 효율적인 풀링 기능 제공됨

### **커넥션 풀 설정 방법**

1. 하이버네이트만 사용시 `persistence.xml` 에서 설정
2. 스프링 부트에서 사용시 [`appication.properties`](http://appication.properties) , `application.yml` 에서 설정 가능

### **커넥션 풀 동작 방식**

1. 초기화
   1. 애플리케이션 시작시 설정된 수만큼의 데이터베이스 연결 미리 생성
   2. 해당 연결들은 풀에 저장되고 사용 가능한 상태로 유지됨
2. 연결 요청
   1. 애플리케이션이 데이터베이스에 연결을 요청하면 풀에서 사용 가능한 연결을 제공
   2. 만약 풀에 사용 가능한 연결 없을 경우
      1. 최대 풀 크기에 도달하지 않았다면 새 연결 생성
      2. 최대 크기라면 요청을 대기 상태
3. 연결 반환
   1. 작업 종료 시 연결을 닫지 않고 풀로 반환
   2. 반환된 연결은 다시 사용 가능 상태로 풀에 저장
4. 유휴 연결 관리
   1. 일정 시간 동안 사용되지 않은 연결은 종료
   2. 풀은 연결이 적절이 유지되는지 주기적으로 검사(헬스 체크)

# Hikari CP

## DataSource

`DataSource` 는 데이터베이스 연결을 관리하고 제공하는 객체로 JDBC에서 데이터베이스와의 연결을 처리하는 인터페이스이다. `DataSource` 는 `Connection` 객체를 얻기 위한 표준 방법을 제공하여 데이터베이스 연결을 효율적으로 관리하는데에 역할이 있다

### 역할

1. 데이터베이스 연결 제공
   1. `DataSource` 는 데이터베이스 연결을 풀에서 관리하고 필요할 때마다 애플리케이션에 연결을 제공하는 역할을 한다.
      1. 이를 통해 연결 생성 비용을 줄일 수 있다
2. 커텍션 풀
   1. 대부분의 경우 `DataSource` 는 커넥션 풀을 사용하여 데이터베이스 연결을 관리한다 커넥션 풀은 일정 개수의 데이터베이스 연결을 미리 생성하여 애플리케이션에서 사용할 수 있도록 연결을 재사용할 수 있도록 돕는다.

### `DataSource` 인터페이스와 구현

- `DataSource` 인터페이스
  - `getConnection()`
    - 데이터베이스와의 연결 가져오는 메서드
  - `getConnection(String username, String password)`
    - 사용자 이름과 비밀번호로 연결 가져옴
- 구현 클래스
  - `HikariDataSource`
    - HikariCP 커넥션 풀을 사용하는 `DataSource` 구현체
    - JPA에서 채택되어 사용된다

### HikariCP

**HikariCP**는 JPA에서 채택되어 널리 사용되는 커넥션 풀 라이브러리 중 하나로, 성능이 뛰어나고 설정이 간단하다는 장점이 있다. `HikariDataSource`는 `DataSource` 인터페이스를 구현하여 커넥션 풀을 관리한다
