# 트랜잭션

트랜잭션은 데이터베이스에서 논리적으로 하나의 작업 단위로 처리되는 일련의 작업들을 의미한다. 트랜잭션은 작업이 완전히 성공적으로 수행되거나 실패 시 데이터베이스의 상태를 원래대로 복구하는 방식으로 이루어져 데이터 무결성을 유지시킨다. 트랜잭션을 통해 데이터베이스의 작업이 일관되고 신뢰할 수 있도록 관리 된다

트랜잭션의 성공 여부는 주로 `COMMIT` 과 `ROLLBACK` 으로 제어된다

- COMMIT : 모든 작업이 성공적으로 완료되었을 경우 트랜잭션을 데이터베이스에 반영한다
- ROLLBACK : 작업 도중 오류가 발생하면 트랜잭션 이전 상태로 되돌려 데이터베이스를 안정된 상태로 유지한다

# ACID

트랜잭션이 데이터베이스에서 안정적으로 수행되기 위해 지켜야하는 4가지 기본 원칙을 ACID라고 한다. 이는 Atomicity, Consistency, Isolation, Durability의 약자이다

## 특성

1. 원자성 (Atomicity)
   1. 트랜잭션의 작업은 모두 하나의 단위로 간주된다
   2. 모두 완료되거나 전혀 수행되지 않아야 한다
   3. 트랜잭션의 일부 작업이 실패할 경우, 전체 트랜잭션이 중단되고 모든 변경 사항은 원래 상태로 복구되어야 한다
2. 일관성 (Consistency)
   1. 트랜잭션이 완료되면 데이터베이스는 항상 일관된 상태를 유지해야 한다
   2. 트랜잭션 시작 전후의 데이터베이스 상태가 정의된 규칙을 준수해야 한다
   3. 데이터 무결성 제약 조건(기본 키, 외래 키, 도메인 제약 조건 등)이 항상 유지된다
3. 고립성 (Isolation)
   1. 여러 트랜잭션이 동시에 실행될 경우 서로의 작업에 간섭하지 않고 독립적으로 수행되어야 한다
   2. 하나의 트랜잭션에서 아직 완료되지 않은 변경 사항이 다른 트랜잭션에서 참조되지 않도록 보장하여야 한다
   3. 격리 수준은 데이터베이스에서 여러 단계로 설정 가능하다
4. 지속성 (Durability)
   1. 트랜잭션이 성공적으로 완료되면 그 결과는 영구적으로 데이터베이스에 반영되어야 한다
   2. 시스템 오류가 발생하더라도 트랜잭션 결과는 손실되지 않고 저장된다

## ACID 를 만족하는 트랜잭션 예시

- 한 계좌에서 돈을 출금하고 다른 계좌에 돈을 입금하는 작업이 `원자성` 에 따라 반드시 함께 완료되거나 모두 취소된다
- 트랜잭션이 시작되기 전과 후에 데이터는 일관된 상태를 유지하여 송금 금액만큼 자산 변화가 생겨야 `일관성` 을 만족하게 된다
- 다른 트랜잭션이 동시에 수행되어도 계좌 잔액이 정확하게 반영되어야 `격리성` 을 유지한다
- 트랜잭션이 커밋되면 시스템 오류가 발생했더라도 데이터베이스는 돈이 입금된 상태로 `지속성` 을 보장해야 한다
